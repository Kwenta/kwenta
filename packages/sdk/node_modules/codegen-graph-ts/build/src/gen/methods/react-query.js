"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const body_1 = require("../segments/body");
/**
 * Writes a single file which contains `useQuery` hooks for calling any subgraph query
 */
function reactquery(schema) {
    const out = [];
    out.push(`import { useQuery, UseQueryOptions } from 'react-query';`);
    out.push((0, body_1.heading)());
    for (const entity of schema.types) {
        const filterEntity = schema.types.find(e => e.name === entity.name + '_filter');
        if (!filterEntity)
            continue;
        out.push((0, body_1.types)(entity, filterEntity));
        out.push(`export const useGet${entity.name}ById = <K extends keyof ${entity.name}Result>(url: string, options?: SingleQueryOptions, args?: ${entity.name}Args<K>, queryOptions: UseQueryOptions<Pick<${entity.name}Result, K>> = {}) => {
            const func = ${(0, body_1.singleBody)(entity)};

            const enabled = options && args;

            return useQuery(
                ['codegen-graphql', enabled ? generateGql('${entity.name}', options, args) : null],
                async () => func(url, options!, args!),
                {
                    ...queryOptions,
                    enabled: !!options && !!args,
                }
            );
        }`);
        out.push(`export const useGet${entity.name}s = <K extends keyof ${entity.name}Result>(url: string, options?: MultiQueryOptions<${entity.name}Filter, ${entity.name}Result>, args?: ${entity.name}Args<K>, queryOptions: UseQueryOptions<Pick<${entity.name}Result, K>[]> = {}) => {
            const func = ${(0, body_1.multiBody)(entity)};

            const enabled = options && args;

            return useQuery(
                ['codegen-graphql', enabled ? generateGql('${entity.name}s', options, args) : null],
                async () => func(url, options!, args!),
                {
                    ...queryOptions,
                    enabled: !!options && !!args,
                }
            );
        }`);
    }
    return out.join('\n');
}
exports.default = reactquery;
